<div class="card shadow-sm h-100 d-flex flex-column chat-container">
  <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
    <h5 class="mb-0">
      <i class="bi bi-robot me-2"></i>YouTube AI Assistant
    </h5>
    <button class="btn btn-outline-light btn-sm" (click)="newVideo()">
      <i class="bi bi-plus me-1"></i>New Video
    </button>
  </div>
  
  <div class="card-body p-0 d-flex flex-column flex-grow-1">
    <!-- Chat Messages Area - Takes available space -->
    <div #chatContainer class="chat-messages flex-grow-1" style="overflow-y: auto; min-height: 0;">
      
      <!-- Welcome Message -->
      <div *ngIf="messages().length === 0" class="welcome-message text-center">
        <div class="welcome-content">
          <i class="bi bi-robot display-4 text-muted mb-3"></i>
          <h5 class="text-muted">Ask me anything about this YouTube video</h5>
          <p class="text-muted">I can summarize, answer questions, and explain concepts from the video content.</p>
        </div>
      </div>

      <!-- Chat Message Loop -->
      <div *ngFor="let message of messages()" 
           [class]="message.type === 'user' ? 'message-user' : 'message-assistant'">
        
        <!-- User Message -->
        <div *ngIf="message.type === 'user'" class="message-bubble user-bubble">
          <div class="message-avatar">
            <i class="bi bi-person-fill"></i>
          </div>
          <div class="message-content">
            <div class="message-text">{{ message.content }}</div>
            <div class="message-time">{{ message.timestamp | date:'shortTime' }}</div>
          </div>
        </div>

        <!-- Assistant Message -->
        <div *ngIf="message.type === 'assistant'" class="message-bubble assistant-bubble">
          <div class="message-avatar">
            <i class="bi bi-robot"></i>
          </div>
          <div class="message-content">
            <div class="message-text bullet-points">{{ message.content }}</div>
            <div class="message-time">{{ message.timestamp | date:'shortTime' }}</div>
          </div>
        </div>
      </div>

      <!-- Loading Message -->
      <div *ngIf="isAsking()" class="message-assistant">
        <div class="message-bubble assistant-bubble">
          <div class="message-avatar">
            <i class="bi bi-robot"></i>
          </div>
          <div class="message-content">
            <div class="message-text typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Alert -->
    <div *ngIf="error()" class="alert alert-warning alert-dismissible fade show m-3 mb-0">
      <i class="bi bi-exclamation-triangle me-2"></i>
      {{ error() }}
      <button type="button" class="btn-close" (click)="error.set('')"></button>
    </div>

    <!-- Input Area - Fixed at bottom -->
    <div class="chat-input-container p-3 border-top bg-white">
      <div class="input-group">
        <textarea 
          class="form-control chat-textarea"
          [value]="question()" 
          (input)="question.set($any($event.target).value)"
          (keydown.enter)="$event.preventDefault(); askQuestion(); question.set('')"
          placeholder="Message YouTube AI Assistant..."
          rows="1"
          [disabled]="isAsking()"
        ></textarea>
        <button 
          class="btn btn-dark chat-send-btn"
          (click)="askQuestion()"
          [disabled]="!question().trim() || isAsking()"
        >
          <i class="bi bi-send-fill"></i>
        </button>
      </div>
      <div class="chat-hint text-muted small mt-2 text-center">
        Press Enter to send â€¢ Shift+Enter for new line
      </div>
    </div>
  </div>
</div>